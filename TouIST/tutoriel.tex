
Ceci n'est pas une séance de TP, vous devez considérer que vous êtes en cours/TD/TP intégrés sur machine. C'est un mélange de cours, de TD et de TP :
\begin{itemize}
\item la partie cours porte essentiellement sur les connecteurs généralisés($\bigwedge_{i\in E}$ et $\bigvee_{i\in E}$) et la description de la syntaxe de \touist ; 
\item la partie TD porte sur l'aspect formalisation des problèmes, et mobilisation des cours précédents pour l'exploitation des résultats du prouveur ; 
\item la partie TP, consiste à mettre tout cela en oeuvre à l'aide de \touist. 
\end{itemize}

Prérequis : afin de tirer bénéfice de ces séances de C/TD/TP, vous devez au préalable maîtriser les savoirs et savoir-faire suivant : 
\begin{itemize}
\item connaître les notions de : variable propositionnelle, valuation, modèle, conséquence logique, (in)satisfaisabilité
\item utiliser correctement les connecteurs logiques pour la modélisation de problèmes
\item évaluer une conséquence logique, rechercher d'un modèle, tirer les bonnes conclusions quant à  leur (in)existence
\end{itemize}

Objectifs : 
À l'issue de ces séances, vous devrez être capable de transformer un problème de type combinatoire (dont le sudoku est un exemple typique) en un problème de satisfiabilité d'un ensemble de formules logiques. Pour cela , vous devrez tirer parti des facilités expressives offertes par les connecteurs généralisés dans \touist. Puis, vous devez pouvoir, à partir des modèles obtenus (ou de leur absence) conclure quant aux solutions du problème concret dont vous serez partis. 

\section{Premiers pas}
\subsection{Démarrage}
\begin{itemize}
\item Vérifiez si \touist est déjà installé : rechercher le fichier "touist.jar". Si plusieurs versions sont présentes, choisissez la plus récente. Les dossiers des précédentes versions de touist peuvent être supprimés.
\item Sinon, ouvrez un navigateur et allez \href{https://www.irit.fr/touist/}{ici} puis appuyez sur "Download".
\item Décompressez le zip et lancez "touist.jar"
\end{itemize}

\medskip
Le {\bf manuel de référence} du langage est disponible \href{https://www.irit.fr/touist/doc/reference-manual.html}{ici} (ou \href{https://www.irit.fr/touist/doc/reference-manual.pdf}{ici} en PDF).

\subsection{Interface graphique}
Dans le cadre de gauche vous saisirez les formules ou ensembles voulus, dans celui de droite vous aurez le rendu visuel. 
\begin{itemize}
\item Tapez \verb?p and q => p?
\item Vous pouvez aussi faire vos saisies en utilisant le mini-éditeur dans le menu complètement à gauche : cliquez sur la case $a => b$, remplacez \$b par p, effacez \$a et cliquez sur "$a\wedge b$" et remplacez \$a par p et \$b par q.
\item On verra le rôle des \$ et l'onglet "Sets" (Ensembles) plus tard. 
\end{itemize}

\begin{center}
	\begin{tabular}{|c|c|c|c|c|c|c|}
		\hline
		 Logique propositionnelle & Langage \touist  \\ \hline
		 $\neg p$ & \texttt{not p} \\ \hline
		 $p \wedge q$ & \texttt{p and q} \\ \hline
		 $p \vee q$ & \texttt{p or q} \\ \hline
		 $p \oplus q$ & \texttt{p xor q} \\ \hline
		 $p \rightarrow q$ & \texttt{p => q} \\ \hline
		 $p \leftrightarrow q$ & \texttt{p <=> q} \\ \hline
	\end{tabular}
\end{center}

\subsection{Utilisation du prouveur}
\subsubsection{Vérifier si une formule admet un modèle (= est satisfiable)}
\begin{enumerate}
\item Saisissez la formule $p\vee q\rightarrow p$
\item Vérifiez, en bas à droite, que le sélecteur est sur "SAT" puis cliquez sur Solve.
\item Le solveur vous indique un modèle de la formule : la valuation $v(p)=0$ et $v(q)=0$. En cliquant sur "Next" vous accédez aux autres modèles (s'il y en a). Les coches "True" et "False" permettent de n'afficher que les propositions à True ou à False. 
\item Retour à l'édition.
\item Saisissez la formule $p\wedge\neg p$. Solve. Vous avez une pop-up qui vous informe qu'il n'y a pas de modèle : la formule est insatisfiable. 
\item Saisissez "p$\vee \neg$ p". Solve : il y a deux modèles sur deux possibles, normal la formule est valide !
\end{enumerate}
Exercice : trouvez les modèles de $(p \vee q \vee r) \wedge (p \rightarrow \neg q) \wedge (q \rightarrow \neg r) \wedge (r\rightarrow \neg p)$. Vérifiez que dans chacun une seule proposition est vraie. 

\subsection{Vérifier si une formule est valide}
Rappel : une formule valide est vraie dans tous les modèles. 

Si l'on saisit une formule et qu'on veut savoir si elle est valide, on doit vérifier qu'elle a autant de modèle qu'il y en a de possibles ! (pas pratique).

On procède indirectement, par réfutation. Si elle est valide, sa négation sera insatisfiable. On teste donc sa négation, ici $\neg(p\vee \neg p)$. Faites-le. Vous constatez qu'il n'y a pas de solution, donc la formule $p\vee \neg p$ est valide ! \\

Exercice : Vérifiez que $pluie \wedge (pluie \rightarrow routeMouillee) \wedge (routeMouillee\rightarrow danger) \rightarrow danger$ est valide. 
\subsection{Vérifier si un ensemble de formules admet un modèle (= est satisfiable)}
On saisit simplement les formules de l'ensemble, les unes au-dessus des autres, puis Solve. \\
Exercice : Vérifiez que l'ensemble $\mathit{cafe\vee the, \neg the}$ est satisfiable. Quel unique modèle admet-il ? 
\subsection{Vérifier si une formule $C$ est conséquence logique d'un ensemble $H$ de formules}
Supposons que $H=\{H1,\cdots,Hn\}$ est un ensemble de $n$ hypothèses.\\
Là encore, il serait fastidieux de vérifier que $C$ est vraie dans tous les modèles de $H$. Là encore on procède indirectement en utilisant le théorème : 
\[H\models C \mbox{ si et seulement si } H\cup\{\neg C\}\mbox{ est insatisfiable}\]
autrement dit, pour vérifier si $H\models C$, on va tester si les formules $H1$, $H2$,\ldots, $Hn$, $\neg C$ prises \emph{toutes ensemble} sont satisfiables. Si ça n'est pas le cas on pourra conclure que $H\models C$. Si c'est pas le cas, on aura au moins un contre-modèle ($\sim$ un contre-exemple) qui nous dira dans quelle situation on a les hypothèses vraies et la conclusion fausse.

Exercice : Testez les conséquences suivantes et donnez un contre-modèle quand elle ne sont pas correctes : 
\begin{itemize}
\item $f\rightarrow m, f \models m$
\item $f\rightarrow m, r\rightarrow m, \neg f\wedge \neg r \models \neg m$\\
(f=j'ai de la fièvre, r=j'ai des rougeurs, m=je suis malade)
\item $f\rightarrow m, r\rightarrow m, \neg m\models \neg f\wedge \neg r $


\item On suppose que l’on a l'ensemble $H$ de règles et faits suivants :

\begin{enumerate}
\item Si le patient a la rougeole, il a de la fièvre.
\item Si le patient a une hépatite, mais pas la rougeole, il a le teint jaune.
\item Si le patient a de la fièvre ou le teint jaune, il a une hépatite ou la rougeole.
\item Le patient n’a pas le teint jaune.
\item Le patient a de la fièvre.
\end{enumerate}

Vérifiez que dans tous les modèles de $H$, la variables $r$ (correspondant à "le patient a la rougeole") est à "vrai". Vérifiez que $H \models r$.
\end{itemize}
\newpage
\section{Les connecteurs généralisés : $\bigwedge_{i \in A}$ et $\bigvee_{i \in A}$}

Pour simplifier l'écriture de certaines formules, il est possible d'utiliser des connecteur logiques généralisés.
Par exemple, considérons une grille de \emph{carré latin}\footnote{comme un sudoku sans la contrainte sur les régions : 1 chiffre par case qui apparaît une seule fois par ligne et par colonne.} $4\times 4$ à résoudre :
\begin{center}
\texttt{
\begin{tabular}{|c|c|c|c|}
	\hline
	~ & ~ & 1 & ~ \\ \hline
	~ &~ & ~ & 2 \\ \hline
	4 & ~ & ~ & ~ \\ \hline
	~ & ~ & 3 &  \\ \hline
\end{tabular}
}\\
\end{center}

Pour chacune des cases, nous définissons quatre variables propositionnelles correspondant aux quatre valeurs possibles $\{1,2,3,4\}$ qu'on écrit aussi $[1..4]$. Ainsi, $p(i,j,k)$ représentera la proposition "La case de coordonnées $(i,j)$ contient la valeur $k$".\\

Pour imposer que la case de coordonnées (2,1) contient l'une des quatre valeurs possibles, nous pouvons utiliser la formule : \\
\[\texttt{p(2,1,\hl{1}) or p(2,1,\hl{2}) or p(2,1,\hl{3}) or p(2,1,\hl{4})}\]

Cette succession de $\vee$ ou seul l'un des indices (surligné) varie peut être condensée en utilisant le $\bigvee$ : 
\[\bigvee_{k\in [1..4]} \texttt{p(2,1,\hl{k})} \]
qui signifie donc "la case (2,1) contient l'une des quatre valeurs possibles", ou "pour l'une au moins des quatre valeurs possibles, cette valeur est dans la case (1,2)". \\

\noindent Remarquez l'analogie avec le $\Sigma$ mathématique avec lequel une expression telle que : 
\[f(x,1)+f(x,2)+\cdots+f(x,10)\]
serait condensée en :
\[\sum_{k\in[1..10]} f(x,k)\]


Nous voulons maintenant exprimer que \emph{toutes} les cases de la ligne 2 (cases de coordonnées (2,x)) contiennent l'une des quatre valeurs possibles : 

\[\bigvee_{k\in [1..4]} \texttt{p(2,\hl{1},k)} \wedge \bigvee_{k\in [1..4]} \texttt{p(2,\hl{2},k)}\wedge
\bigvee_{k\in [1..4]} \texttt{p(2,\hl{3},k)} \wedge
\bigvee_{k\in [1..4]} \texttt{p(2,\hl{4},k)}\] 

Pour cela, nous utilisons le $\bigwedge$ en faisant varier l'indice surligné et obtenons : 
\[\bigwedge_{j\in [1..4]}\bigvee_{k\in [1..4]} \texttt{p(2,\hl{j},k)}\]

Ce qui peut se lire "pour chaque case de la ligne 2, pour au moins une valeur de [1..4], cette valeur est dans la case". \\

Afin maintenant d'exprimer la même chose pour chaque ligne, nous généralisons en faisant varier le numéro de ligne : 

\[\bigwedge_{j\in [1..4]}\bigvee_{k\in [1..4]} \texttt{p(\hl{1},j,k)}\wedge \bigwedge_{j\in [1..4]}\bigvee_{k\in [1..4]} \texttt{p(\hl{2},j,k)}\wedge \bigwedge_{j\in [1..4]}\bigvee_{k\in [1..4]} \texttt{p(\hl{3},j,k)}\wedge \bigwedge_{j\in [1..4]}\bigvee_{k\in [1..4]} \texttt{p(\hl{4},j,k)}\]

soit, en utilisant à nouveau le $\bigwedge$ :

\[\bigwedge_{i\in [1..4]}\bigwedge_{j\in [1..4]}\bigvee_{k\in [1..4]} \texttt{p(\hl{i},j,k)}\]
Qui peut se lire "Pour chaque case (i,j) de la grille, il y a au moins une valeur parmi les quatre possibles qui y figure". \\

\noindent NB : sans ces facilités d'écriture, il aurait fallu 64 propositions et 63 connecteurs pour écrire la même chose. \\

Cette écriture est possible dans \touist en utilisant des variables \texttt{\$i}, \texttt{\$j} et \texttt{\$k}.

Ce qui donne : 
\begin{verbatim}
1 |  bigand $i in [1..4]:
2 |    bigand $j in [1..4]:
3 |      bigor $k in [1..4]:
4 |        p($i,$j,$k)
5 |      end
6 |    end
7 |  end
\end{verbatim}

% \begin{center}
% 	\begin{tabular}{cV{4cm}} \toprule
% 		Logique propositionnelle & Langage \touist \\ \midrule
% 		Pour $n\in \mathbb{N}^{*}$, $\underset{i\in [1..n]}{\bigwedge}p_{i}$ & 
% 		\begin{verbatim}
% 		bigand $i in [1..n]:
% 		    p($i)
% 		end
% 		\end{verbatim}
% 		\\ \hline
% 		Pour $n\in \mathbb{N}^{*}$, $\underset{i\in [1..n]}{\bigvee}p_{i}$ & 
% 		\begin{verbatim}
% 		bigor $i in [1..n]:
% 		    p($i)
% 		end
% 		\end{verbatim}
%          \\ \hline
% 	\end{tabular}
% \end{center}

Exercice : Résoudre le Sudoku $4\times 4$ donné en exemple en utilisant les connecteurs généralisés :
\begin{itemize}
	\item Écrire une formule qui décrit l'état initial de la grille ci-dessus ;
    \item Recopier la formule qui impose que chaque cellule contienne \textbf{au moins} une valeur de $[1..4]$ ;
	\item Écrire une formule qui impose que chaque cellule contienne \textbf{au plus} une valeur parmi $[1..4]$ 
Indice : si une cellule contient une valeur alors elle n'en contient pas d'autre. Par exemple, pour exprimer que la case $(1,4)$ contient seulement un 3, il faut parvenir à écrire une formule disant que toute autre valeur que 3 est absente de la case $(2,3)$, en formule : 
\[\texttt{p(1,4,\hl{3}) => (not p(1,4,\hl{1}) and not p(1,4,\hl{2}) and not p(1,4,\hl{4})})\]
\end{itemize}
On remarque qu'en partie droite de cette implication, on retrouve toutes les valeurs possibles \emph{sauf} 3. Le langage de \touist permet d'exprimer cela de manière compacte grâce à la clause \texttt{when}: 

\[\texttt{p(1,4,3) => bigand \$k in [1..4] \hl{when \$k!= 3}: not p(1,4,\$k)}\]

De manière générale dans : 
\begin{verbatim}
   ....
   bigand $i in [1..4] when $i != $j : ....
\end{verbatim}
(\$i ne prendra pas la valeur qu'a \$j)

Il ne reste plus qu'à appliquer ce principe à toutes les cases\ldots

\begin{itemize}
    \item Dans la même veine, écrire une formule qui interdit deux valeurs identiques dans les cellules d'une même ligne ;
    \item Faire de même pour les colonnes ;\\
    Muni(e) de ces formules résolvez le carré latin du dessus, et vérifiez qu'il admet plusieurs solutions. 
    \item (Difficile) Passons au sudoku $4\times 4$ : sachant que, dans \touist, il est possible d'effectuer des opérations arithmétiques sur des variables entières (par exemple \texttt{p(\$u+\$i,\$v+\$j,\$k)}), écrire une formule qui interdit deux valeurs identiques dans les cellules d'une même région.\\
    Vérifiez que le carré latin peut être résolu avec les règles du sudoku et n'admet alors plus qu'une solution. 
    
\item Modifiez vos formules pour traiter un sudoku classique ($9\times 9$), et résolvez \href{http://puzzling.stackexchange.com/questions/252/how-do-i-solve-the-worlds-hardest-sudoku}{celui-ci par exemple} (l'un des plus difficiles au monde). 
\end{itemize}

\section{Les ensembles}

Nous avons vu comment définir des variables entières utilisées comme indices.
Nous allons maintenant voir comment utiliser des ensembles génériques pour construire des formules avec les connecteurs généralisés. L'intérêt sera notamment de séparer les règles de résolution d'un problème qui seront définies par des formules permettant de résoudre tout problème de même nature, et des ensembles définissant un problème particulier. Par exemple, dans le cas du Sudoku, les formules permettront de résoudre n'importe quel Sudoku, et les ensembles définiront la grille de Sudoku que nous souhaitons résoudre en particulier.\\

L'onglet "Sets" nous permet de définir de tels ensembles. Par exemple, nous souhaitons remplacer les chiffres contenus dans les cases du Sudoku par des lettres. Nous pouvons alors définir l'ensemble $L=\{A,B,C,D\}$ par \texttt{\$L=[A,B,C,D]} dans l'onglet "Sets" et remplacer \texttt{\$k in [1..4]} par \texttt{\$k in \$L} dans les formules.\\

Exercice : résoudre le sudoku $4\times 4$ : 

\begin{center}
\texttt{
\begin{tabular}{|c|c|c|c|}
	\hline
	A & B & ~ & ~ \\ \hline
	~ & D & ~ & ~ \\ \hline
	~ & ~ & A & ~ \\ \hline
	~ & ~ & C & B \\ \hline
\end{tabular}
}\\
\end{center}

Exercice : Coloration de cartes.\\

Le théorème des 4 couleurs, qui fut conjecturé en 1852 par Francis Guthrie, affirme qu'on peut colorer toute carte géographique en utilisant seulement 4 couleurs tout en veillant à ce que deux pays limitrophes reçoivent des couleurs différentes. Il a été (enfin) démontré en 1976 par Appel et Haken. La démonstration a exigé l'usage de l'ordinateur pour étudier les 1478 cas critiques (plus de 1200 heures de calcul à l'époque). \\

Soit l'ensemble de pays européens (on ne les considère pas tous, mais vous pouvez) : \\
\begin{multline}
P = \{Portugal, Espagne, France, Italie, Suisse, Belgique, PaysBas, Pologne, Autriche,\\ RepTcheque, Slovenie, Croatie, Luxembourg, Allemagne\}
\end{multline}
Formalisez le problème de la coloration de pays : 
\begin{itemize}
\item Chaque pays reçoit une et une seule couleur
\item Deux pays limitrophes reçoivent des couleurs différentes
\item Si A est limitrophe avec B, alors B l'est avec A. 
\end{itemize}
Vous définirez l'ensemble $P$ des pays et l'ensemble $C$ des couleurs (disons $\{Jaune, Rouge, Vert, Bleu\})$. \\

\noindent Vous utiliserez les propositions : 
\begin{itemize}
\item \texttt{r(p,c)} : "le pays p reçoit la couleur c"
\item \texttt{l(p1,p2)} : "le pays p1 est limitrophe avec le pays p2"
\end{itemize}

NB : en cas de doute, pour savoir lesquels de ces pays sont limitrophes, consultez \href{https://upload.wikimedia.org/wikipedia/commons/6/6a/Europe_countries_map_fr.png}{cette carte}. \\

Utilisez \touist pour découvrir une solution à quatre couleurs. Puis testez s'il existe une solution à trois couleurs. 
\newpage
\section{Traitement des aspects dynamiques}\label{sec:prob}
Jusqu'ici, nous avons traité de problèmes combinatoires statiques : la solution ne nécessite pas d'ordonner une série d'éléments contrairement à ce qui se passe par exemple dans un jeu où il ne suffit pas de savoir quels coups seront joués mais aussi dans quel ordre. 

Un système qui nécessite la prise en compte de quelque chose (à définir) qui évolue est appelé \emph{système dynamique}. Le système évolue donc en passant d'un \emph{état} à un autre, chaque état pouvant être décrit à l'aide d'une formule logique\footnote{On parle aussi de système de transition ou de système à état discret.}. Une des façons d'en rendre compte est de rendre explicite le déroulement du temps, en général un temps discret qui s'incrémente de 1 entre deux états. Mais on peut aussi en rendre compte tout simplement en nommant les états successifs, le passage du temps étant marqué par le nom des actions effectuées. 

\textsc{BlocksWorld} est un monde simplifié pour étudier des problèmes de
planification qu'un robot doit résoudre dans le monde réel. La simplification
concerne les objets à manipuler (des blocs empilés, d'où le nom) et les
opérations que le robot peut effectuer (dans notre cas, déplacer un bloc d'une
pile sur une autre). 
%-------------------------------------------
\subsection{Modélisation du domaine}\label{sec:form_dom}

\textsc{BlocksWorld} est un monde très carré: un ensemble de \emph{blocs} empilés, ce
qui donne un ensemble de tours plus ou moins élevées de blocs. En plus, ces
tours ne peuvent pas se trouver n'importe où, mais uniquement sur des
\emph{tables}. Nous parlons d'\emph{emplacement} pour désigner aussi bien un bloc qu'une table.

Il y a des actions qui modifient le \textsc{BlocksWorld} et donc l'état du monde 
dépend du temps. Par contre, il y a aussi des propriétés immuables, par exemple, être un bloc ou une table.

Dans un premier temps, nous supposons que notre monde est composé de quatre
blocs \texttt{B1,...,B4} et deux tables \texttt{T1,T2}. Si nécessaire, nous apporterons
des modifications. 

Pour modéliser le fait qu'un bloc \texttt{b} se trouve sur un emplacement \texttt{p} (c'est à
dire, une table ou un autre bloc), nous utilisons la famille de variables indexées
\texttt{Sur}. Puisque la position dépend aussi du temps \texttt{s}, on obtient donc
des propositions de la forme \texttt{Sur(b,p,s)}. Le temps est discret; pour cela,
nous parlons aussi d'\emph{état} ou de \emph{situation}. Nous le modélisons par un nombre
naturel. Nous considérons d'abord un intervalle \texttt{[0..9]}.

Pour commencer, nous formalisons quelques exigences concernant \texttt{Sur}. Vous utiliserez des ensembles (Sets) pour spécifier les différentes valeurs (intervalle temporel, nom des blocs et autres). 

\begin{exo}\label{ex:unique_sous}
Donnez une formule qui exprime qu'à tout moment, au plus un emplacement peut se
  trouver \emph{sous} un bloc. Autrement dit, un bloc ne peut pas reposer sur
  plusieurs supports.
\end{exo}
%......................................................................
\begin{figure}[h]
\begin{subfigure}[b]{0.5\textwidth}
\centering
\begin{tikzpicture}[scale=0.5,auto,
block/.style ={rectangle, draw=blue, fill=blue!20,
  text width=2em, text centered, rounded corners,
  minimum height=1em
},
place/.style ={rectangle, draw=green, thick, fill=green!20,
  text width=3em, text centered, rounded corners,
  minimum height=1em
}]
\node (b1) at (-1,1) [block] {$B_1$};
\node (b2) at (1,1) [block] {$B_2$};
\node (p1) at (0,0) [place] {$T_1$};
\end{tikzpicture}
\caption{}\label{fig:unique_sur}
\end{subfigure}%
%
\begin{subfigure}[b]{0.5\textwidth}
\centering
\begin{tikzpicture}[scale=0.5,auto,
block/.style ={rectangle, draw=blue, fill=blue!20,
  text width=2em, text centered, rounded corners,
  minimum height=1em
},
place/.style ={rectangle, draw=green, thick, fill=green!20,
  text width=3em, text centered, rounded corners,
  minimum height=1em
}]
\node (b1) at (0,1) [block] {$B_1$};
\node (b2) at (-1,0) [block] {$B_2$};
\node (b3) at (1,0) [block] {$B_3$};
\end{tikzpicture}
\caption{}\label{fig:unique_sous}
\end{subfigure}%
%
\caption{Configurations illégales}\label{fig:config_illeg}
\end{figure}

\begin{exo}\label{ex:unique_sur_sous_ex} 
Définissez les formules qui décrivent la situation de la
  figure~\ref{fig:unique_sur}. Montrez que cette situation n'est pas
  compatible avec l'exigence de l'exercice~\ref{ex:unique_sur}. Pareil,
  montrez que la figure~\ref{fig:unique_sous} n'est pas compatible avec la
  formule de l'exercice~\ref{ex:unique_sous}.
\end{exo}

\begin{exo}\label{ex:tables}En utilisant un ensemble pour les \emph{tables}, donnez une formule qui exprime qu'une table ne peut pas se trouver sur un  emplacement. Dans un premier temps, les tables sont \texttt{T1} et \texttt{T2}.
\end{exo}


Nous nous limitons donc à des situations où il y a, en bas, un nombre de
tables sur lesquelles on peut empiler des blocs, de manière linéaire, comme
dans la figure~\ref{fig:ex3}.
Pourtant, les exigences imposées jusqu'à maintenant (donc l'ensemble des
formules à l'exception des formules pour
l'exercice~\ref{ex:unique_sur_sous_ex}) n'excluent pas des situations
apparemment ``absurdes'' qui ne correspondent pas à une réalité physique.


\begin{exo}\label{ex:sur_asym_satisfiable}
Montrez que, sous les hypothèses formalisées jusqu'à maintenant, il n'est
  pas incohérent que le bloc \texttt{B1} est sur le bloc \texttt{B2} et en même temps
  \texttt{B2} sur \texttt{B1}.
  \end{exo}

  \begin{exo}\label{ex:sur_asym}
  Pour éviter cette situation, donnez une formule qui exprime que \texttt{Sur}
  est asymétrique dans toute situation \texttt{s}. \emph{Rappel:} une relation $R$ est dite
  asymétrique si $\forall x. \forall y. (R(x,y) \to  \lnot R(y,x))$.
\end{exo}

\begin{exo}\label{ex:sur_irrefl}
  Démontrez avec \textsc{\touist} que, pour tout instant \texttt{s}, l'asymétrie
  de \texttt{Sur} implique l'irréflexivité de \texttt{Sur}. \emph{Rappel:} une
  relation $R$ est dite irréflexive si $\forall x. \lnot R(x,x)$.

  \emph{Aide:} vous devez montrer que $A \models I$, où la formule $A$ exprime
  l'asymétrie et la formule $I$ l'irréflexivité de \texttt{Sur}. Trouvez une
  formule contenant $A$ et $I$ qui est insatisfiable si et seulement si $A
  \models I$, et montrez avec \textsc{\touist} que cette formule est
  effectivement insatisfiable.
\end{exo}



\begin{exo}\label{ex:sur_cycl}
Supposons désormais que \texttt{Sur} est asymétrique. Montrez que, même sous
  cette hypothèse, on ne peut pas exclure la situation suivante: \texttt{B1} est sur
  le bloc \texttt{B2}, \texttt{B2} sur \texttt{B3} et \texttt{B3} sur \texttt{B1}.
  \end{exo}
\begin{exo}\label{ex:unique_sur}
Donnez une formule qui exprime qu'à tout moment  \texttt{s} de notre intervalle
  temporel de référence modélisé par la variable \texttt{\$Time}, au plus un bloc peut se
  trouver \emph{sur} un emplacement. Autrement dit, un emplacement ne peut pas porter
  plusieurs blocs.
\end{exo}


\section{Formalisation des actions}\label{sec:form_act}

%......................................................................
\begin{figure}[h]
\begin{subfigure}[b]{0.5\textwidth}
\centering
\begin{tikzpicture}[scale=0.5,auto,
block/.style ={rectangle, draw=blue, fill=blue!20,
  text width=2em, text centered, rounded corners,
  minimum height=1em
},
place/.style ={rectangle, draw=green, thick, fill=green!20,
  text width=3em, text centered, rounded corners,
  minimum height=1em
}]
\node (b1) at (0,2) [block] {$B_1$};
\node (b2) at (0,1) [block] {$B_2$};
\node (p1) at (0,0) [place] {$T_1$};
\node (b3) at (3,2) [block] {$B_3$};
\node (b4) at (3,1) [block] {$B_4$};
\node (p2) at (3,0) [place] {$T_2$};
\end{tikzpicture}
\caption{}\label{fig:ex3}
\end{subfigure}%
%
\begin{subfigure}[b]{0.5\textwidth}
\centering
\begin{tikzpicture}[scale=0.5,auto,
block/.style ={rectangle, draw=blue, fill=blue!20,
  text width=2em, text centered, rounded corners,
  minimum height=1em
},
place/.style ={rectangle, draw=green, thick, fill=green!20,
  text width=3em, text centered, rounded corners,
  minimum height=1em
}]
\node (b2) at (0,1) [block] {$B_2$};
\node (p1) at (0,0) [place] {$T_1$};
\node (b1) at (3,3) [block] {$B_1$};
\node (b3) at (3,2) [block] {$B_3$};
\node (b4) at (3,1) [block] {$B_4$};
\node (p2) at (3,0) [place] {$T_2$};
\end{tikzpicture}
\caption{}\label{fig:ex4}
\end{subfigure}%
%
\caption{Dispositions des blocs sur des tables}\label{fig:blocs_tables1}
\end{figure}

%......................................................................

\begin{exo}\label{ex:libre}
Pour faciliter la formalisation des actions, définissez 
  \texttt{Libre($p$,$s$)}, où $p$ est un emplacement et $s$ un état, qui dit que
  dans l'état $s$, il n'y a pas de bloc sur $p$. 
\end{exo}

L'action de notre robot consiste à déplacer un bloc d'un emplacement à un
autre. Pour le décrire, nous introduisons \texttt{Depl(b,p,s)} avec la signification d'un déplacement de $b$ vers l'emplacement $p$, au
moment $s$. Ainsi, le passage de la situation \ref{fig:ex3} à la situation
\ref{fig:ex4} est décrit par \texttt{Depl(B1,B3,0)}, si \ref{fig:ex3} est
la situation initiale, donc au moment $s = 0$.
L'emplacement du bloc $b$ dans l'état $s$ devrait être connu; pour
cela, il serait redondant de rajouter le point de départ de $b$ au prédicat
\texttt{Depl}.

Pour qu'un tel déplacement d'un bloc puisse avoir lieu, quelques conditions
doivent être satisfaites:

\begin{itemize}
\item le bloc $b$ doit être libre (il n'est pas possible de retirer $b$ du
  milieu d'une pile)
\item de même pour l'emplacement $p$;
\item comme mentionné avant, on ne peut pas transporter des tables, mais
  uniquement des blocs.
\end{itemize}

Le déplacement entraîne quelques changements entre l'état actuel (disons $s$)
et l'état suivant ($s + 1$):
\begin{itemize}
\item $b$ est maintenant sur $p$,
\item tandis que $b$ reste libre;
\item et son emplacement précédent est maintenant libre.
\end{itemize}

Il faudra aussi préciser que les blocs qui n'ont pas bougé restent sur leurs
emplacements précédents.

\begin{exo}\label{ex:depl}
Formalisez ces conditions. Vous obtenez une implication de la forme
  \texttt{Depl(b,p,s) $\to \; F_1 \land F_2 \land \dots$}, où les $F_i$
  sont les faits évoqués en haut.  N'oubliez pas les quantifications
  $\bigwedge$ et $\bigvee$ nécessaires.
\end{exo}

\begin{exo}\label{ex:progr}
Nous avons encore besoin d'une propriété de ``progrès'': Le passage d'un
  instant à l'instant suivant est toujours accompagné de l'exécution d'une
  action. Donc, à chaque instant, un bloc est déplacé.
  (Quels résultats obtenez vous sans cette clause?)
\end{exo}

  Pourvu que l'état d'arrivée est satisfiable, sans cette clause, on obtient
  toujours une solution où \texttt{Depl} est faux et on atteint l'état
  d'arrivée ``par magie''.

\section{Expérimentation}\label{sec:exper}

Nous allons maintenant utiliser \textsc{\touist} pour synthétiser un plan
pour atteindre un état, à partir d'un état de départ. L'état de départ est
caractérisé par un nombre de conditions au temps $s = 0$. Pour savoir si un
état est atteignable en $n$ pas (ou moins), vous posez le problème s'il existe
un $s$ dans l'intervalle $0 \dots n$ qui satisfait la condition d'arrivée. 

\begin{exo}\label{ex:exp1}
En partant de la situation initiale de la figure~\ref{fig:ex3}, montrez qu'il existe une
  situation où $B_4$ est sur $B_3$.
  \end{exo}

\begin{exo}\label{ex:exp1_neg}
Étant donnée la situation de la figure~\ref{fig:ex3}, montrez qu'on ne peut pas
  atteindre en 5 pas une situation où $B_2$ est sur $B_4$. 
  \end{exo}

  \emph{Question de réflexion:} Ce résultat n'est pas une preuve
  d'inatteignabilité de l'état pour un nombre arbitraire de pas. Combien de
  configurations a le \textsc{BlocksWorld} avec 2 tables et 4 blocs? Quel est
  le nombre maximal de pas à prendre en compte pour prouver l'inatteignabilité
  d'un état? (N'essayez pas de le faire).

\begin{exo}\label{ex:exp2}
Par contre, si vous rajoutez une troisième table $T_3$, il est bien possible
  d'atteindre la situation où $B_2$ est sur $B_4$.
    \end{exo}


\begin{exo}\label{ex:exp3}
Vérifiez qu'on ne peut, en $x$ étapes passer de la situation de la figure \ref{fig:ex5a} à la situation \ref{fig:ex5b} pour $x$  valant 3,4,5 ou plus. Ajoutez une table et vérifiez qu'il existe une solution en 5 étapes. 
%......................................................................
\begin{figure}[h]
\begin{subfigure}[b]{0.5\textwidth}
\centering
\begin{tikzpicture}[scale=0.5,auto,
block/.style ={rectangle, draw=blue, fill=blue!20,
  text width=2em, text centered, rounded corners,
  minimum height=1em
},
place/.style ={rectangle, draw=green, thick, fill=green!20,
  text width=3em, text centered, rounded corners,
  minimum height=1em
}]
\node (b2) at (0,1) [block] {$B_1$};
\node (p1) at (0,0) [place] {$T_1$};
\node (b1) at (0,3) [block] {$B_3$};
\node (b3) at (0,2) [block] {$B_2$};
\node (p2) at (3,0) [place] {$T_2$};
\end{tikzpicture}
\caption{}\label{fig:ex5a}
\end{subfigure}%
%
\begin{subfigure}[b]{0.5\textwidth}
\centering
\begin{tikzpicture}[scale=0.5,auto,
block/.style ={rectangle, draw=blue, fill=blue!20,
  text width=2em, text centered, rounded corners,
  minimum height=1em
},
place/.style ={rectangle, draw=green, thick, fill=green!20,
  text width=3em, text centered, rounded corners,
  minimum height=1em
}]
\node (b2) at (3,1) [block] {$B_1$};
\node (p1) at (0,0) [place] {$T_1$};
\node (b1) at (3,3) [block] {$B_3$};
\node (b3) at (3,2) [block] {$B_2$};
\node (p2) at (3,0) [place] {$T_2$};
\end{tikzpicture}
\caption{}\label{fig:ex5b}
\end{subfigure}%
%
\caption{Problème à 3 blocs}\label{fig:blocs_tables2}
\end{figure}

%......................................................................
  \end{exo}

\begin{exo}\label{ex:exp4}
Quelle est la longueur du plan optimal pour passer de la situation de la figure \ref{fig:ex6a} à la situation \ref{fig:ex6b} ? Cherchez d'abord une solution ``à la main''. 
%......................................................................
\begin{figure}[h]
\begin{subfigure}[b]{0.5\textwidth}
\centering
\begin{tikzpicture}[scale=0.5,auto,
block/.style ={rectangle, draw=blue, fill=blue!20,
  text width=2em, text centered, rounded corners,
  minimum height=1em
},
place/.style ={rectangle, draw=green, thick, fill=green!20,
  text width=3em, text centered, rounded corners,
  minimum height=1em
}]
\node (p1) at (0,0) [place] {$T_1$};
\node (b1) at (0,1) [block] {$B_1$};
\node (b2) at (0,2) [block] {$B_2$};
\node (b3) at (0,3) [block] {$B_3$};

\node (p2) at (3,0) [place] {$T_2$};
\node (b1) at (3,1) [block] {$B_4$};
\node (b2) at (3,2) [block] {$B_5$};
\node (b3) at (3,3) [block] {$B_6$};

\node (p2) at (6,0) [place] {$T_3$};
\node (b1) at (6,1) [block] {$B_7$};
\node (b2) at (6,2) [block] {$B_8$};
\node (b3) at (6,3) [block] {$B_9$};

\end{tikzpicture}
\caption{}\label{fig:ex6a}
\end{subfigure}%
%
\begin{subfigure}[b]{0.5\textwidth}
\centering
\begin{tikzpicture}[scale=0.5,auto,
block/.style ={rectangle, draw=blue, fill=blue!20,
  text width=2em, text centered, rounded corners,
  minimum height=1em
},
place/.style ={rectangle, draw=green, thick, fill=green!20,
  text width=3em, text centered, rounded corners,
  minimum height=1em
}]
\node (p1) at (0,0) [place] {$T_1$};
\node (b1) at (0,1) [block] {$B_1$};
\node (b1) at (0,2) [block] {$B_4$};
\node (b1) at (0,3) [block] {$B_7$};

\node (p2) at (3,0) [place] {$T_2$};
\node (b2) at (3,1) [block] {$B_2$};
\node (b2) at (3,2) [block] {$B_5$};
\node (b2) at (3,3) [block] {$B_8$};

\node (p2) at (6,0) [place] {$T_3$};
\node (b3) at (6,1) [block] {$B_3$};
\node (b3) at (6,2) [block] {$B_6$};
\node (b3) at (6,3) [block] {$B_9$};
\end{tikzpicture}
\caption{}\label{fig:ex6b}
\end{subfigure}%
%
\caption{Problème à 9 blocs}\label{fig:blocs_tables3}
\end{figure}

%......................................................................
  \end{exo}
  
  
%\begin{verbatim}
%;;-----------------------------------------
%;; problème #2, $FinTemps = 5, 3 blocs, 3 tables
%;;Sur(B1,T1,0) and Sur(B2,B1,0) and Sur(B3,B2,0) and Libre(B3,0) and Libre(T2,0) and Libre(T3,0)
%;;bigor $t in $Instants:
%;;  Sur(B1,T2,$t) and Sur(B2,B1,$t) and Sur(B3,B2,$t) end
%;;-----------------------------------------
%
%;;-----------------------------------------
%;; problème #3, $FinTemps = ?? au mieux, 6 blocs, 3 tables
%;; faire chercher à la main
%    Sur(B1,T1,0) and Sur(B2,T2,0) and Sur(B3,T3,0) 
%and Sur(B4,B1,0) and Sur(B5,B2,0) and Sur(B6,B3,0)
%and Sur(B7,B4,0) and Sur(B8,B5,0) and Sur(B9,B6,0)
%and Libre(B7,0) and Libre(B8,0) and Libre(B9,0)
%
%bigor $t in $Instants:
%    Sur(B1,T1,$t) and Sur(B4,T2,$t) and Sur(B7,T3,$t) 
%and Sur(B2,B1,$t) and Sur(B5,B4,$t) and Sur(B8,B7,$t)
%and Sur(B3,B2,$t) and Sur(B6,B5,$t) and Sur(B9,B8,$t)
%and Libre(B3,$t) and Libre(B6,$t) and Libre(B9,$t)
%end
%;;-----------------------------------------
%\end{verbatim}







\cleardoublepage
\appendix

\section{\texttt{\touist} en un clin d'oeil}
\begin{itemize}
\item Un bloc de formules suivi d'un bloc de données, séparés par le mot-clef \texttt{data}. Dans les blocs, les espaces et saut de ligne n'ont aucune signification. Les commentaires débutent par la séquence \texttt{;;} et finissent en bout de ligne. 
\item Le bloc de données permet d'initialiser des variables de type entier, décimale ou ensemble (un ensemble ne peut contenir que des entiers ou que des décimaux ou que des chaînes de caractères). Un identificateur de variable est une chaîne alphanumérique précéde du caractère '\$' p. ex. : 
	\begin{itemize}
	\item \verb+$a=5					;; variable entière+
	\item \verb+$Pi=3.14				;; variable décimale+
	\item \verb+$Table=[a,b,c,d]		;; variable ensemble+
    \end{itemize}

\item Une variable peut être initialisée avec n'importe quelle expression, incluant d'autres variables à condition que celles-ci aient été initialisées plus haut, p. ex. :
\begin{itemize}
	\item \verb&$a=5&
	\item \verb&$Pi=float(a mod 3)+1.14&
	\item \verb&$Table=[a,b,c,d]&
    \item \verb&$Meubles=union($Tables,[a,b,c,d])&\\
%    Une variable peut aussi désigner une fonction dont on précisera les valeurs pour chaque valeur d'argument possible, ainsi :
%    \item \verb+$nbJours(31)=[Jan,Mar,May]+
%    \item \verb+$nbJours(28)=[Feb]+
%    \item \verb+$nbJours(30)=[Apr,Jun,Sep]+\\
	\end{itemize}
\item Les expressions peuvent être formées à l'aide des opérateurs suivants : 
	\begin{itemize}
	\item numériques : \texttt{\_+\_}, \texttt{\_-\_}, \texttt{\_*\_}, 
    \texttt{\_/\_}, \texttt{sqrt(\_)}, \texttt{\_mod\_},  
    et les opérateurs de conversion de 
        type \texttt{int(\_)} (par partie entière) et \texttt{float(\_)} ; 
	\item ensemblistes : \texttt{union(\_,\_)}, 
    \texttt{inter(\_,\_)}, 	\texttt{diff(\_,\_)}. 
	\item Ajoutons aussi l'opérateur :
	\begin{verbatim}
	if <bool> then <expr> else <expr> end
    \end{verbatim}
	où les \texttt{<expr>} peuvent être des expressions numériques ou 
    ensemblistes, et \texttt{bool-expr} une expressionn booléenne faisant 
    intervenir nombres et ensembles, et incluant :
	\begin{itemize}
	\item les connecteurs logiques habituels (voir plus bas)
	\item les opérateurs de comparaison standard (\texttt{\_<\_, \_>\_, \_<=\_, 
    \_>=\_, \_==\_, \_!=\_}) plus les constantes \texttt{true} et \texttt{false}
	\item les comparateurs ensemblistes : \texttt{subset(\_,\_)}, 
    \texttt{\_==\_}, \texttt{\_!=\_}\\
	\end{itemize}
    \end{itemize}

\item Le bloc de formules interprète celles-ci comme leur conjonction. La syntaxe des formules est classique et respecte les règles de priorité habituelles pour le parenthésage. 
\item Les connecteurs usuels sont disponibles : $\lnot$ (\texttt{not\_} dans la syntaxe \touist), $\wedge$ (\texttt{\_and\_}), $\vee$ (\texttt{\_or\_}), $\rightarrow$ (\texttt{\_=>\_}), $\leftrightarrow$ (\texttt{\_<=>\_}), $\oplus$\footnote{Ou-exclusif} (\texttt{\_xor\_}). 
\item Les atomes sont de la forme \texttt{prop(arg-1,arg-2,\ldots,arg-n)}, où les \texttt{arg-i} peuvent être des constantes (entières, décimales ou chaînes de caractères), des variables globales ou des variables locales. \emph{NB : \texttt{prop} aussi peut être une constante ou une variable !}
\item Ceci est particulièrement utile avec les connecteurs généralisés \texttt{bigand} et \texttt{bigor} dont la syntaxe est la suivante : 
\begin{table}[!ht]\centering
\begin{tabular}{|cV{13cm}|} \hline
& \begin{verbatim}
bigand <var>,<var>,... in <set>,<set>,... when <bool>:
    <form>
end
\end{verbatim} \\ \hline
\end{tabular}
\end{table}
\FloatBarrier

où 
\begin{enumerate}
\item les \texttt{<var>} sont des  des variables locales (c'est-à-dire uniquement définie dans le corps du \texttt{bigand}); 
\item les \texttt{<set>} sont des expressions ensemblistes ;
\item voir plus haut pour les \texttt{<bool>}. 
\item \texttt{<form>} est elle-même une formule.
\end{enumerate}
\end{itemize}


\section{Plus de détails sur le langage \texttt{touistl}}

\subsection{La structure d'un fichier \texttt{touistl}}
Dans les anciennes versions utilisées (v1.3.0 et en deçà), il y avait un onglet ``formules'' et un onglet ``ensembles (Sets)''. Dans les versions actuelles (v2.1.0 et au-delà) il n'y a qu'une seule zone de texte. On y écrit les affectations d'ensembles puis les formules ou bien le contraire (si les affectations sont à la fin, alors le séparateur \texttt{data} est requis) :
\begin{center}\centering
\begin{tabular}{r V{4cm} | r V{4cm} } 
Données (facultatif) & \begin{verbatim}
<affect>
<affect>
\end{verbatim} & Formules & \begin{verbatim}
<form1>   
<form2>
<form3>
\end{verbatim}\\
Formules & \begin{verbatim}
<form1> 
<form2>
<form3>
\end{verbatim} & Données (facultatif) & 
\begin{verbatim}
data
<affect>
<affect>
\end{verbatim}
\end{tabular}
\end{center}

On écrit une ligne par formule (lorsqu'on est en dehors d'un \texttt{bigand}, \texttt{bigor} ou tout autre opérateur de construction de formules). Cet ensemble de lignes correspond à la conjonction des formules listées :
$$ \{ f_1, f_2, f_3 \} \quad \equiv \quad f_1 \wedge f_2 \wedge f_3$$

Les commentaires commencent par "\texttt{;;}".
\subsection{Les valeurs de base}
Il y a trois types de valeurs : 
\begin{itemize}
\item les chaînes de caractères alphanumériques (lettres et chiffres uniquement) : \texttt{a}, \texttt{B}, \texttt{A1},\texttt{1A}\ldots (elles ne peuvent apparaître que dans des ensembles)
\item les valeurs numériques (entières ou décimales), p.ex. : \texttt{2}, \texttt{-4.51}, \ldots
\item les ensembles typés:
\begin{itemize}
\item ensemble de chaînes de caractères : p. ex. \texttt{[A1,B,C2,4A]}
\item ensemble d'entiers : p.ex. \texttt{[1,2,3,4]}, mais aussi par énumération \texttt{[1..4]} (l'incrément est toujours 1)
\item ensemble de décimaux : p.ex. \texttt{[1.01,3.1,-7.2]}, mais aussi par énumération \texttt{[2.1 .. 7.1]}. {\bfseries (Attention : il est indispensable que la longueur de l'intervalle soit un nombre entier... sinon boucle infinie !).}
\end{itemize}: 
\end{itemize}

\subsection{Les opérations sur les nombres \texttt{<num>}}
Les opérations sur les nombres \texttt{<num>} (entiers ou flottants) sont typées : on ne peut pas ajouter un décimal et un entier sans convertir l'un des deux dans le type de l'autre au préalable.

\subsection{Les variables \texttt{<var>}} 
Les identificateurs de variables sont toujours préfixées du caractère '\$' : p. ex. \texttt{\$i, \$x, \$suivant}, \dots{} Leur contenu peut être \texttt{<prop>}, \texttt{<num>} ou \texttt{<set>}. Les variables peuvent être de deux types : globales (définies dans un \texttt{<affect>}) ou locales (définies avec \texttt{let} ou dans un \texttt{bigand} ou \texttt{bigor}).

\subsubsection{Les variables globales et \texttt{<affect>}}
Une variable globale est immutable. Elle est définie par une affectation placée au tout début ou tout à la fin des formules (pour le second cas, le mot-clé \texttt{data} permet de séparer les formules des affectations). Une affectation \texttt{<affect>} permet de définir une unique variable \texttt{<var>}. L'affectation \texttt{<affect>} est de la forme :
$$\texttt{\$var = <num|set|prop>}$$
et peut éventuellement être une variable-tuple, c'est à dire qui est contient des indices ; les indices doivent alors être des entiers,  ou des propositions (les deux peuvent être mélangés pour former le nom de la variable).
$$\texttt{\$var(<num|prop>,...) = <num|prop|set>}$$

Voici une description des affectations \texttt{<affect>} (après le mot-clé \texttt{data}) :

\begin{center}
\begin{tabular}{r >{\tt}V{5cm}} \toprule
\multicolumn{1}{c}{Logique propositionnelle} & \normalfont{\touist} \\ \midrule
Déclarations \texttt{<affect>} &\$i = 1 \\
(après le mot-clé \texttt{data}) & \$t = d\\
&\$N = 2*\$x \\
&\$s = [1..3] \\
et même &\begin{verbatim}
$A = if $i==1 
     then [a,b,c]
     else [a,b,$t] end\end{verbatim}\\ \hline
Variables-tuples & \$A(r,1) = union(\$N,[4..8]) \\
& \$A(r,2) = [\$i..7 mod \$N] \\
\end{tabular}
\end{center}

\subsubsection{Les variables locales}
Ces variables sont utilisées dans les connecteurs généralisés \texttt{bigand} et \texttt{bigor} pour parcourir les valeurs d'un ensemble.
Il est aussi possible d'utiliser des variables locales à une formule. Attention, la variable n'existe plus après \texttt{<form>}. La syntaxe est la suivante : \\

\begin{center}
\begin{tabular}{|cV{5cm}|} \hline
& \begin{verbatim}
let $var = <num|prop>: <form>
\end{verbatim} \\ \hline
\end{tabular}
\end{center}

Contrairement aux variables globales, les variables locales sont restreintes à la syntaxe \texttt{\$var} (pas de variables-tuples).


\subsection{Les formules \texttt{<form>}}

Une formule logique \texttt{<form>} est composée de propositions (\texttt{<prop>}) et de connecteurs logiques liant les propositions.

\subsubsection{Les propositions logiques \texttt{<prop>}}

Une proposition logique se compose d'une chaîne de caractères alphanumériques commençant par une lettre. Elle peut soit être un simple mot, (e.g., \texttt{malade}) ou bien un mot suivi de propositions ou nombres entre parenthèses (e.g., \texttt{poser(oeuf,1,table)}). Voici quelques exemples de propositions logiques \texttt{<prop>} :

\begin{center}
\begin{tabular}{r >{\tt}V{3cm} | r >{\tt}V{3cm}} \toprule
\multicolumn{2}{c}{Proposition simple} & \multicolumn{2}{c}{Proposition composée} \\ \midrule
 & p & & a(1,b) \\
 & avoir2bras &  & avoir(2,bras)\\ \\
\end{tabular}
\end{center}


\subsubsection{Propositions construites à partir de variables}
Une proposition \texttt{<prop>} peut être composée de variables qui, lorsqu'elles sont remplacées par leur contenu (\texttt{<prop>} ou \texttt{<num>}) forment une proposition. Voici quelques exemples de constructions de propositions \texttt{<prop>} :\\

\begin{center}
\begin{tabular}{r >{\tt}V{3cm} >{\tt}c >{\tt}c} \toprule
&\normalfont{Si on a les variables} & {\normalfont avec la formule} & \normalfont{ça deviendra} \\ \midrule
 &\$O=abcd & \$O & abcd \\ \hline
 &\$u=2 & p(\$u) & p(2) \\ \hline
 &\begin{verbatim}
$x=43
$y=ver\end{verbatim} & \$y(\$x) & ver(43) \\ \hline
& \begin{verbatim}
$f=prop
$i=wouaf\end{verbatim} & \$f(3,\$i) & prop(3,ouaf) \\ \hline
& \begin{verbatim}
$a=2
$b=3\end{verbatim} & g(\$a-2,\$a*\$b) & g(0,6) \\
\end{tabular}
\end{center}

\subsubsection{Les connecteurs (généralisé inclus)}

Le tableau ci-dessous donne à gauche les connecteurs usuels utilisables en tant que \texttt{<form>} et à droite leur syntaxe \touist :

\begin{center} \centering
\begin{tabular}{r c >{\tt}V{4cm}} \toprule
\multicolumn{2}{c}{Logique propositionnelle} & {\normalfont \touist} \\ \midrule
Négation & $\neg p$ & not p \\
Conjonction &$p \wedge q$ & p and q \\
Disjonction &$p \vee q$ & p or q \\
Ou exclusif &$p \oplus q$ & p xor q \\
Implication &$p \rightarrow q$ & p => q \\
Équivalence &$p \leftrightarrow q$ & p <=> q \\
Quantification bornée &$\bigwedge\limits_{\substack{i\in E}} p_i$ & \begin{verbatim}
bigand $i in <set>:
    p($i) 
end\end{verbatim} \\
&$\bigvee\limits_{\substack{i\in E}} p_i$ & \begin{verbatim}
bigor $i in <set>:
    p($i)
end\end{verbatim} \\
Condition & & \begin{verbatim}if <bool>
  then p(1,e) 
  else p(1,c) end\end{verbatim}\\
\end{tabular}
\end{center}

Les expressions ensemblistes \texttt{<set>} sont présentées plus bas. La syntaxe des constructeurs de formules \texttt{bigand} et \texttt{bigor} est la suivante :
\begin{center}
\begin{tabular}{|cV{13cm}|} \hline
& \begin{verbatim}
bigand <var>,<var>,... in <set>,<set>,... when <bool>:
    <form>
end
\end{verbatim} \\ \hline
\end{tabular}
\end{center}


où 
\begin{enumerate}
\item \texttt{<var>} est une variable locale (c'est à dire uniquement définie dans le corps du \texttt{bigand}); 
\item \texttt{<set>} est un ensemble défini explicitement (comme montré dans les exemples : \texttt{[a,b]} \texttt{[1..4]}... ou bien une variable globale définie comme un ensemble après la balise \texttt{data} ;
\item \texttt{<form>} est une formule propositionnelle telle que définie précédemment ;
\item \texttt{<bool>} est une une expression booléenne (aussi avec des \texttt{and}, \texttt{or}, \texttt{not}, \texttt{=>}, mais aussi et surtout des opérations sur les entiers : \texttt{<}, \texttt{>}, \texttt{==}, \texttt{!=}, \text{in}...)
\end{enumerate}

Voici deux exemples permettant d'illustrer l'utilisation des deux opérateurs \texttt{bigand} et \texttt{bigor} :

\begin{center}
\begin{tabular}{|cV{10cm}|} \hline
$\bigwedge\limits_{\substack{i\in [1..n]\\j \in [a,b,c]}} p_{i,j}$ & 
\begin{verbatim}
bigand $i,$j in [1..n],[a,b,c]:
    p($i,$j)
end
\end{verbatim}
\\ \hline
$\bigvee\limits_{\substack{v\in [A,B,C]\\x \in [1..9]\\y\in[3..4]\\x \ne y \\ x \ne A\\}} v_{x,y}$ &
\begin{verbatim}
bigor $v,$x,$y in [A,B,C],[1..9],[3..4] when $v!=A 
                                        and $x!=$y:
    $v($x)
end
\end{verbatim} 
\\ \hline
\end{tabular}
\end{center}


\subsection{Les entiers, flottants \texttt{<num>} et booléens \texttt{<bool>}}

Les expressions booléennes \texttt{<bool>} s'écrivent par exemple dans le \texttt{when} d'un \texttt{bigand} ou dans la condition d'un \texttt{if}. Les entiers et flottants \texttt{<num>} s'utilisent par exemple comme indice d'une proposition ou comme élément d'un ensemble.

Les opérateurs sur les nombres \texttt{<num>} et booléens \texttt{<bool>} sont définis dans le tableau suivant :

\begin{center}
\begin{tabular}{r c >{\tt}V{4cm}} \toprule
\multicolumn{2}{c}{Logique propositionnelle} & {\normalfont \touist} \\ \midrule
Opérations usuelles & $1 + 2$ & 1 + 2 \\
sur entier et flottants &$1 - 2$ & 1 - 2\\
&$1 \times 2$ & 1 * 2\\
&$1 / 2$ & 1 / 2\\
&$1 - 2$ & 1 - 2\\
&$\sqrt{2}$ & sqrt(2)\\
Modulo &$1 \mod 2$ & 1 mod 2\\
Condition & & \begin{verbatim}if <bool>
  then 4
  else 2 end\end{verbatim} \\
Partie entière&  & int(2.7)\\ 
Conversion en décimal & & float(3) \\ \hline
Opérateurs sur \texttt{<num>}& $1 < 2$ & 1 < 2\\
compatibles \texttt{<bool>}& $1 > 2$ & 1 > 2\\
& $1 \le 2$ & 1 <= 2\\
& $1 \ge 2$ & 1 >= 2\\
& $\neg (1>2)$ & not 1>2 \\
&$(1=5) \wedge (1\ne 3)$ & 4==8 and 1!=3 \\
&$\sqrt{3}>1 \vee 4 \ge 9$ & sqrt(3)>1 or 4>=9 \\
&$(1>2) \oplus (3 \ne 9)$ & (1>2) xor (3!=9) \\
&$(1>2) \rightarrow (3 \ne 9)$ & 1>2 => 3!=9 \\
&$(1>2) \leftrightarrow (3 \ne 9)$ & 1>2 <=> 3!=9 \\
Constantes \texttt{<bool>}& & true\\
& & false
\end{tabular}
\end{center}

\subsection{Les ensembles \texttt{<set>}}

Opérateurs sur les ensembles \texttt{<set>} :
\begin{center}
\begin{tabular}{r c >{\tt}V{4cm}} \toprule
\multicolumn{2}{c}{Logique propositionnelle} & {\normalfont \touist} \\ \midrule
Ensemble d'entiers & $\{1,2,3\}$ & [1,2,3] \\
&$\{i|i=1,\dots,n\}$ & [1..n]\\
Ensemble de termes & $\{a,b,c\}$ & [a,b,c]\\
Opérations sur ensembles & $E \cup F$ & inter(\$E,\$F)\\
& $E \cap F$ & union(\$E,\$F)\\
& $E \setminus F$ & diff(\$E,\$F)\\
Condition & & \begin{verbatim}if <bool>
  then [1..3]
  else [4..5] end\end{verbatim}\\
Opérateurs vers entier & $Card(E)$ & card(\$E,\$F)\\ \hline
Opérateurs sur \texttt{<set>}& $E=\emptyset$ & empty(\$E,\$F)\\
compatibles \texttt{<bool>}& $2 \in [1..3]$ & 2 in [1..3]\\
\end{tabular}
\end{center}


%......................................................................
